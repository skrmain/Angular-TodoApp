<form [formGroup]="todoForm" (submit)="addTodo()" class="mt-4">
    <div class="form-group row">
        <div class="col-12 input-group-lg">
            <input type="text" class="form-control" placeholder="Title" formControlName="title" />
        </div>
        <div class="col-12 input-group-lg">
            <textarea
                type="text"
                class="form-control"
                placeholder="Detail"
                formControlName="detail"
                aria-describedby="inputGroup-sizing-lg"
            ></textarea>
        </div>
        <div class="col-2">
            <button type="submit" class="btn btn-outline-success">Add</button>
        </div>
    </div>
</form>
<div class="mt-5">
    <ul class="p-3" *ngIf="todos.length">
        <li *ngFor="let todo of todos" class="row bg-white border align-items-center">
            <span class="col-2 text-center">
                <button
                    *ngIf="todo.status === 'created'"
                    [disabled]="!canUpdate(todo.permissions)"
                    class="btn"
                    (click)="markDone(todo._id, todo.title)"
                >
                    <i class="bi bi-square text-success" style="font-size: 1.3rem"></i>
                </button>
                <button
                    *ngIf="todo.status === 'done'"
                    [disabled]="!canUpdate(todo.permissions)"
                    class="btn"
                    (click)="markUnDone(todo._id, todo.title)"
                >
                    <i class="bi bi-check-square-fill text-success" style="font-size: 1.3rem"></i>
                </button>
            </span>
            <div class="col-8 my-2" [style]="{ 'text-decoration': todo.status === 'done' ? 'line-through' : 'initial' }">
                <h3 class="h5" [style]="{ 'text-decoration': todo.status === 'done' ? 'line-through' : 'initial' }">
                    {{ todo.title }}
                </h3>

                <span class="text-muted">{{ todo.detail }}</span>
            </div>
            <span class="col-2 text-center">
                <!-- <button
                    *ngIf="todo.status === 'done'"
                    [disabled]="!canUpdate(todo.permissions)"
                    class="btn"
                    (click)="markArchive(todo._id, todo.title)"
                >
                    <i class="bi bi-archive text-secondary"></i>
                </button> -->
                <button [disabled]="!canShare(todo.permissions)" class="btn" (click)="openShareModal(todo._id)">
                    <i class="bi bi-share-fill text-primary" style="font-size: 1.3rem"></i>
                </button>
                <!-- <button [disabled]="!canDelete(todo.permissions)" class="btn" (click)="deleteTodo(todo._id)">
                    <i class="bi bi-trash text-danger"></i>
                </button> -->
            </span>
        </li>
    </ul>
    <div class="modal" tabindex="-1" aria-hidden="true" *ngIf="shareModalVisible">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Share Todo</h5>
                    <button type="button" (click)="closeShareModal()" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form [formGroup]="searchForm" (submit)="searchUser()">
                        <div>
                            <input type="text" formControlName="username" (input)="searchUser()" />
                        </div>
                    </form>
                    <div>
                        <p
                            *ngFor="let user of searchedUsers"
                            class="btn d-block"
                            [ngClass]="{ 'btn-outline-primary': user._id !== selectedUserId, 'btn-primary': user._id === selectedUserId }"
                            (click)="selectUser(user._id)"
                        >
                            {{ user.username }}
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="closeShareModal()">Cancel</button>
                    <button type="button" class="btn btn-primary" (click)="shareTodo()">Share</button>
                </div>
            </div>
        </div>
    </div>
    <p *ngIf="!todos.length" class="text-center mt-5">No Todo</p>
</div>
